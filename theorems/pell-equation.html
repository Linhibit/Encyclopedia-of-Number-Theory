<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>佩尔方程 - 数论百科</title>
    <link rel="stylesheet" href="../style.css">
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    
    <script 
        id="MathJax-script" 
        async 
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
</head>

<body>
    <div class="article-container" 
         style="max-width: 800px; 
                margin: 40px auto; 
                padding: 20px;">
        
        <nav>
            <a href="../index.html" class="back-home" aria-label="返回首页">
                <svg class="icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg>
                返回首页
            </a>
        </nav>
        
        <header>
            <h1>佩尔方程 (Pell's Equation)</h1>
        </header>

        <section class="theorem-box" 
                 style="border-left: 5px solid #d32f2f; 
                        background: #fff8f8; 
                        padding: 20px; 
                        margin: 20px 0;">
            
            <strong>方程形式：</strong>
            <p>
                佩尔方程的标准形式为：
                $$x^2 - dy^2 = 1$$
                其中 $d$ 是一个非平方的正整数（即 $d$ 不是完全平方数）。
            </p>
            
            <p>
                <strong>基本解：</strong>
                设 $(x_1, y_1)$ 是所有正整数解中最小的解（称为基本解或最小解），则方程的所有正整数解 $(x_n, y_n)$ 可由下式生成：
                $$x_n + y_n\sqrt{d} = (x_1 + y_1\sqrt{d})^n, \quad n = 1, 2, 3, \dots$$
            </p>
            
            <p>
                等价地，可以通过递推公式计算：
                $$
                \begin{cases}
                x_{n+1} = x_1 x_n + d y_1 y_n \\
                y_{n+1} = x_1 y_n + y_1 x_n
                \end{cases}
                $$
            </p>
        </section>

        <section class="theory" 
                 style="background: #f0f8ff; 
                        padding: 20px; 
                        margin: 20px 0; 
                        border-radius: 5px;">
            
            <h3>理论基础：</h3>
            
            <ol style="line-height: 1.6;">
                <li>
                    <strong>解的存在性：</strong>
                    对于非平方正整数 $d$，佩尔方程 $x^2 - dy^2 = 1$ 总有正整数解，且有无穷多组解。
                </li>
                
                <li>
                    <strong>基本解的唯一性：</strong>
                    存在唯一的最小正整数解 $(x_1, y_1)$，称为基本解。
                </li>
                
                <li>
                    <strong>解的结构：</strong>
                    所有解 $(x_n, y_n)$ 满足 $x_n + y_n\sqrt{d} = (x_1 + y_1\sqrt{d})^n$。
                </li>
                
                <li>
                    <strong>负佩尔方程：</strong>
                    方程 $x^2 - dy^2 = -1$ 不一定有解。如果有解，设其基本解为 $(x_0, y_0)$，
                    则 $x^2 - dy^2 = 1$ 的基本解为 $(x_0^2 + dy_0^2, 2x_0y_0)$。
                </li>
            </ol>
        </section>

        <section class="method" 
                 style="background: #f9f9f9; 
                        padding: 20px; 
                        margin: 20px 0; 
                        border-radius: 5px;">
            
            <h3>求解方法：连分数法</h3>
            
            <p>
                $\sqrt{d}$ 的连分数展开是周期的。设其循环节长度为 $l$：
            </p>
            
            <ol style="line-height: 1.6;">
                <li>
                    如果 $l$ 是偶数，则 $x^2 - dy^2 = 1$ 的基本解为连分数收敛的第 $l-1$ 个渐近分数 $p_{l-1}/q_{l-1}$。
                </li>
                <li>
                    如果 $l$ 是奇数，则 $x^2 - dy^2 = 1$ 的基本解为连分数收敛的第 $2l-1$ 个渐近分数 $p_{2l-1}/q_{2l-1}$。
                </li>
            </ol>
            
            <p>
                <strong>连分数展开步骤：</strong>
            </p>
            
            <ol style="line-height: 1.6;">
                <li>设 $a_0 = \lfloor \sqrt{d} \rfloor$，$m_0 = 0$，$b_0 = 1$。</li>
                <li>递推计算：
                    $$
                    \begin{aligned}
                    m_{k+1} &= b_k a_k - m_k \\
                    b_{k+1} &= \frac{d - m_{k+1}^2}{b_k} \\
                    a_{k+1} &= \left\lfloor \frac{a_0 + m_{k+1}}{b_{k+1}} \right\rfloor
                    \end{aligned}
                    $$
                </li>
                <li>当出现 $a_k = 2a_0$ 时，连分数开始循环。</li>
            </ol>
        </section>

        <section class="example" 
                 style="background: #f5f5f5; 
                        padding: 20px; 
                        margin: 20px 0; 
                        border-radius: 5px;">
            
            <h3>示例：</h3>
            
            <p>
                <strong>示例1：</strong> 求解 $x^2 - 2y^2 = 1$。
            </p>
            
            <p>
                <strong>解法：</strong>
                <ol>
                    <li>$\sqrt{2} = 1.4142...$，连分数展开：$\sqrt{2} = [1;\overline{2}]$，循环节长度 $l=1$（奇数）。</li>
                    <li>由于 $l$ 是奇数，基本解为第 $2l-1=1$ 个渐近分数。</li>
                    <li>计算渐近分数：
                        <ul>
                            <li>$p_0 = 1, q_0 = 1$</li>
                            <li>$p_1 = 1 \times 2 + 1 = 3, q_1 = 2$</li>
                        </ul>
                    </li>
                    <li>验证：$3^2 - 2 \times 2^2 = 9 - 8 = 1$，所以基本解为 $(3, 2)$。</li>
                    <li>通解：$x_n + y_n\sqrt{2} = (3 + 2\sqrt{2})^n$。</li>
                </ol>
            </p>
            
            <p>
                <strong>示例2：</strong> 求解 $x^2 - 7y^2 = 1$。
            </p>
            
            <p>
                <strong>解法：</strong>
                <ol>
                    <li>$\sqrt{7} = 2.6457...$，连分数展开：$\sqrt{7} = [2; \overline{1, 1, 1, 4}]$，循环节长度 $l=4$（偶数）。</li>
                    <li>由于 $l$ 是偶数，基本解为第 $l-1=3$ 个渐近分数。</li>
                    <li>计算渐近分数：
                        <ul>
                            <li>$a_0 = 2, a_1 = 1, a_2 = 1, a_3 = 1, a_4 = 4$</li>
                            <li>$p_0 = 2, q_0 = 1$</li>
                            <li>$p_1 = 2 \times 1 + 1 = 3, q_1 = 1$</li>
                            <li>$p_2 = 3 \times 1 + 2 = 5, q_2 = 1 \times 1 + 1 = 2$</li>
                            <li>$p_3 = 5 \times 1 + 3 = 8, q_3 = 2 \times 1 + 1 = 3$</li>
                        </ul>
                    </li>
                    <li>验证：$8^2 - 7 \times 3^2 = 64 - 63 = 1$，所以基本解为 $(8, 3)$。</li>
                </ol>
            </p>
        </section>

        <section class="code-example" 
                 style="background: #2d2d2d; 
                        padding: 20px; 
                        margin: 20px 0; 
                        border-radius: 5px;">
            
            <h3 style="color: #f8f8f2;">代码示例 (JavaScript)：</h3>
            
            <pre style="background: #1e1e1e; 
                        color: #f8f8f2; 
                        padding: 15px; 
                        border-radius: 5px; 
                        overflow-x: auto;">
<code>// 计算d的平方根连分数展开
function continuedFractionSqrt(d) {
    const a0 = Math.floor(Math.sqrt(d));
    if (a0 * a0 === d) {
        throw new Error("d必须是完全平方数");
    }
    
    const terms = [a0];
    const seen = new Map();
    let m = 0;
    let b = 1;
    let a = a0;
    let key;
    
    while (true) {
        m = b * a - m;
        b = Math.floor((d - m * m) / b);
        a = Math.floor((a0 + m) / b);
        
        key = `${m},${b},${a}`;
        if (seen.has(key)) {
            break;
        }
        
        seen.set(key, terms.length);
        terms.push(a);
    }
    
    return {
        a0: a0,
        periodic: terms.slice(1), // 循环部分
        full: terms
    };
}

// 计算连分数的渐近分数
function convergents(terms) {
    const p = [terms[0], terms[0] * terms[1] + 1];
    const q = [1, terms[1]];
    
    for (let i = 2; i < terms.length; i++) {
        p[i] = terms[i] * p[i-1] + p[i-2];
        q[i] = terms[i] * q[i-1] + q[i-2];
    }
    
    return { p, q };
}

// 求解佩尔方程 x² - dy² = 1 的基本解
function solvePellBasic(d) {
    const cf = continuedFractionSqrt(d);
    const periodicLen = cf.periodic.length;
    
    // 计算足够多的渐近分数
    const terms = [cf.a0, ...cf.periodic];
    // 扩展循环部分以获得足够的项
    const extendedTerms = [cf.a0];
    for (let i = 0; i < periodicLen * 2; i++) {
        extendedTerms.push(cf.periodic[i % periodicLen]);
    }
    
    const conv = convergents(extendedTerms);
    
    // 根据循环节长度确定基本解的位置
    let index;
    if (periodicLen % 2 === 0) {
        // 偶数循环节，基本解在 l-1 处
        index = periodicLen - 1;
    } else {
        // 奇数循环节，基本解在 2l-1 处
        index = 2 * periodicLen - 1;
    }
    
    return {
        x: conv.p[index],
        y: conv.q[index],
        index: index
    };
}

// 生成佩尔方程的第n个解
function pellSolution(d, n) {
    const basic = solvePellBasic(d);
    const x1 = basic.x;
    const y1 = basic.y;
    
    // 使用快速幂计算 (x1 + y1√d)^n
    function powerSolution(exp) {
        let x = 1n;
        let y = 0n;
        let xPow = BigInt(x1);
        let yPow = BigInt(y1);
        let e = BigInt(exp);
        
        while (e > 0n) {
            if (e % 2n === 1n) {
                // 乘以当前幂
                const newX = x * xPow + BigInt(d) * y * yPow;
                const newY = x * yPow + y * xPow;
                x = newX;
                y = newY;
            }
            // 平方当前幂
            const newXPow = xPow * xPow + BigInt(d) * yPow * yPow;
            const newYPow = 2n * xPow * yPow;
            xPow = newXPow;
            yPow = newYPow;
            
            e >>= 1n;
        }
        
        return { x: Number(x), y: Number(y) };
    }
    
    return powerSolution(n);
}

// 示例使用
console.log("=== 佩尔方程求解 ===");

// 示例1：x² - 2y² = 1
console.log("\n1. x² - 2y² = 1");
const sol1 = solvePellBasic(2);
console.log(`基本解: (${sol1.x}, ${sol1.y})`);
console.log(`验证: ${sol1.x}² - 2×${sol1.y}² = ${sol1.x*sol1.x - 2*sol1.y*sol1.y}`);

// 生成前5个解
console.log("前5个解:");
for (let n = 1; n <= 5; n++) {
    const sol = pellSolution(2, n);
    console.log(`n=${n}: (${sol.x}, ${sol.y})`);
}

// 示例2：x² - 7y² = 1
console.log("\n2. x² - 7y² = 1");
const sol2 = solvePellBasic(7);
console.log(`基本解: (${sol2.x}, ${sol2.y})`);
console.log(`验证: ${sol2.x}² - 7×${sol2.y}² = ${sol2.x*sol2.x - 7*sol2.y*sol2.y}`);

// 示例3：x² - 13y² = 1
console.log("\n3. x² - 13y² = 1");
const sol3 = solvePellBasic(13);
console.log(`基本解: (${sol3.x}, ${sol3.y})`);
console.log(`验证: ${sol3.x}² - 13×${sol3.y}² = ${sol3.x*sol3.x - 13*sol3.y*sol3.y}`);

// 验证连分数展开
console.log("\n=== 连分数展开验证 ===");
const testD = [2, 3, 5, 6, 7, 8, 10, 11, 12, 13];
for (const d of testD) {
    try {
        const cf = continuedFractionSqrt(d);
        console.log(`√${d} = [${cf.a0}; ${cf.periodic.map((v, i) => i === cf.periodic.length-1 ? v + ']' : v).join(', ')}`);
        console.log(`  循环节长度: ${cf.periodic.length}`);
    } catch (e) {
        // 忽略完全平方数
    }
}</code>
            </pre>
        </section>

        <section class="applications" 
                 style="background: #f0f8ff; 
                        padding: 20px; 
                        margin: 20px 0; 
                        border-radius: 5px;">
            
            <h3>应用：</h3>
            
            <ol style="line-height: 1.6;">
                <li>
                    <strong>代数数论：</strong>
                    研究二次域的单位群。
                </li>
                
                <li>
                    <strong>丢番图逼近：</strong>
                    提供 $\sqrt{d}$ 的最佳有理逼近。
                </li>
                
                <li>
                    <strong>组合数学：</strong>
                    某些递推关系的通项公式。
                </li>
                
                <li>
                    <strong>密码学：</strong>
                    某些公钥密码系统的构造。
                </li>
                
                <li>
                    <strong>数学史：</strong>
                    古代数学问题（如"牛群问题"）的求解。
                </li>
            </ol>
        </section>

        <section class="history" 
                 style="background: #fffde7; 
                        padding: 15px; 
                        margin: 20px 0; 
                        border-left: 3px solid #ffd600;">
            
            <h4>📝 历史背景：</h4>
            <p>
                佩尔方程得名于英国数学家约翰·佩尔（John Pell，1611-1685），但实际上他对这个方程的贡献很小。
                这个命名是欧拉的一个错误造成的。
            </p>
            
            <p>
                佩尔方程在古代就被研究过。阿基米德的"牛群问题"涉及佩尔方程 $x^2 - 4729494y^2 = 1$，
                但直到20世纪才完全解决。
            </p>
            
            <p>
                印度数学家婆罗摩笈多（Brahmagupta，598-668）发现了佩尔方程的"再生"性质：
                如果 $(x_1, y_1)$ 和 $(x_2, y_2)$ 是解，那么 $(x_1x_2 + dy_1y_2, x_1y_2 + x_2y_1)$ 也是解。
            </p>
        </section>
    </div>
</body>
</html>